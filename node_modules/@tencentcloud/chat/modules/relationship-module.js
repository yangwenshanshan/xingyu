let e={A2KEY_AND_TINYID_UPDATED:"_inner1",CLOUD_CONFIG:"_inner2",PROFILE_UPDATED:"_inner3",CONV_SYNC_COMPLETED:"_inner4",C2C_UNREAD_HANDLE_COMPLETED:"_inner5"},t,s,i=(t="undefined"!=typeof console?console:"undefined"!=typeof global&&global.console?global.console:"undefined"!=typeof window&&window.console?window.console:{},function(){}),n=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=n.length;for(;r--;)s=n[r],console[s]||(t[s]=i);var o=t;class a{constructor(e=0,t=0){this.high=e,this.low=t}equal(e){return null!==e&&this.low===e.low&&this.high===e.high}toString(){var e=Number(this.high).toString(16);let t=Number(this.low).toString(16);if(t.length<8){let e=8-t.length;for(;e;)t="0"+t,e--}return e+t}}let d={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",IPV6:"wss://wssv6.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",BACKUP_WEB:"wss://*w4c.my-cpaas.com",BACKUP_CN:"wss://wss.im.tencent.cn",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",IPV6:"wss://wssv6.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",BACKUP_WEB:"wss://*w4c.my-cpaas.com",BACKUP_CN:"wss://wss.im.tencent.cn",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT0:"wss://*w4s.my-imcloud.com",DEFAULT:"wss://wsssgp.im.qcloud.com",IPV6:"wss://wsssgpv6.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",BACKUP_WEB:"wss://*w4s.my-cpaas.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT0:"wss://*w4k.my-imcloud.com",DEFAULT:"wss://wsskr.im.qcloud.com",IPV6:"wss://wsskrv6.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",BACKUP_WEB:"wss://*w4k.my-cpaas.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT0:"wss://*w4g.my-imcloud.com",DEFAULT:"wss://wssger.im.qcloud.com",IPV6:"wss://wssgerv6.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",BACKUP_WEB:"wss://*w4g.my-cpaas.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT0:"wss://*w4i.my-imcloud.com",DEFAULT:"wss://wssind.my-imcloud.com",IPV6:"wss://wssindv6.im.qcloud.com",BACKUP:"wss://wssind.im.qcloud.com",BACKUP_WEB:"wss://*w4i.my-cpaas.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.19.46"},JPN:{DEFAULT0:"wss://*w4j.my-imcloud.com",DEFAULT:"wss://wssjpn.im.qcloud.com",IPV6:"wss://wssjpnv6.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",BACKUP_WEB:"wss://*w4j.my-cpaas.com",STAT:"https://apijpn.my-imcloud.com",ANYCAST:"wss://162.14.13.254"},USA:{DEFAULT0:"wss://*w4u.my-imcloud.com",DEFAULT:"wss://wssusa.im.qcloud.com",IPV6:"wss://wssusav6.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",BACKUP_WEB:"wss://*w4u.my-cpaas.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT0:"wss://*w4y.my-imcloud.com",DEFAULT:"wss://wssidn.im.qcloud.com",IPV6:"wss://wssidnv6.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",BACKUP_WEB:"wss://*w4y.my-cpaas.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},u={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15,DONUT_NATIVE_APP:19,NS_NATIVE_APP:20,RN_NATIVE_APP:21},c="CHINA",l={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent(e=c){this.CURRENT=d.PRODUCTION[e]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",GRP_SEARCH:"group_search",GRP_MEMBER_SEARCH:"group_member_search",USER_SEARCH:"user_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},p=(new a(0,Math.pow(2,1)).toString(),new a(0,Math.pow(2,2)).toString(),new a(0,Math.pow(2,3)).toString(),new a(0,Math.pow(2,4)).toString(),new a(0,Math.pow(2,6)).toString(),new a(0,Math.pow(2,7)).toString(),new a(0,Math.pow(2,9)).toString(),new a(0,Math.pow(2,10)).toString(),new a(0,Math.pow(2,11)).toString(),new a(0,Math.pow(2,13)).toString(),new a(0,Math.pow(2,15)).toString(),new a(Math.pow(2,6)).toString(),new a(Math.pow(2,7)).toString(),new a(Math.pow(2,8)).toString(),new a(Math.pow(2,9)).toString(),new a(Math.pow(2,10)).toString(),new a(Math.pow(2,16)).toString(),new a(Math.pow(2,20)).toString(),"sns"),h=(l.HOST.setCurrent(c),"undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&("mac"===wx.getSystemInfoSync().platform||"windows"===wx.getSystemInfoSync().platform)),m="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting)||h,_=(m&&wx.createGamePortal,"undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting)),f="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),g="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),w="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),y="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,A="undefined"!=typeof uni&&"undefined"==typeof window&&"function"==typeof uni.requireNativePlugin,I=m&&"object"==typeof wx.miniapp,T=m||_||f||g||w||A||y,D="undefined"==typeof window&&!T&&"undefined"!=typeof global&&void 0!==global.NativeScriptGlobals,M="undefined"!=typeof global&&(void 0!==global.nativeModuleProxy||void 0!==global.ReactNative),L="undefined"!=typeof uni?!T:"undefined"!=typeof window&&!T&&!M,S=(_?qq:f?tt:g?swan:w?my:m?wx:A?uni:y&&jd,L&&window&&window.navigator&&window.navigator.userAgent||""),F=/(micromessenger|webbrowser)/i.test(S),E=function(){let e="WEB";return F?e="WEB":_?e="QQ_MP":f?e="TT_MP":g?e="BAIDU_MP":w?e="ALI_MP":m?e=I?"DONUT_NATIVE_APP":"WX_MP":A?e="UNI_NATIVE_APP":D?e="NS_NATIVE_APP":M&&(e="RN_NATIVE_APP"),u[e]}(),v=(!function(){var e=S.match(/OS (\d+)_/i);e&&e[1]&&e[1]}(),function(){var e,t,s=S.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);s&&(e=s[1]&&parseFloat(s[1]),t=s[2]&&parseFloat(s[2]),e)&&t&&parseFloat(s[1]+"."+s[2])}(),/MSIE/.test(S)||-1<S.indexOf("Trident")&&-1<S.indexOf("rv:11.0")),P=(!function(){var e=/MSIE\s(\d+)\.\d/.exec(S),e=e&&parseFloat(e[1]);!e&&/Trident\/7.0/i.test(S)&&/rv:11.0/.test(S)}(),"C2C"),k="AllowType_Type_AllowAny",U="AdminForbid_Type_None",b="Add_Type_Single",C="Add_Type_Both",N="Delete_Type_Single",G="Delete_Type_Both",O="Pendency_Type_Both",$="Pendency_Type_ComeIn",R="Pendency_Type_SendOut",q="Response_Action_Agree",x="Response_Action_AgreeAndAdd",H="CheckResult_Type_Both",B="CheckResult_Type_Single",W=function(){return(new Date).getTime()+0},K="Tag_Profile_IM_Nick",j="Tag_Profile_IM_Gender",V="Tag_Profile_IM_BirthDay",Y="Tag_Profile_IM_Location",J="Tag_Profile_IM_SelfSignature",z="Tag_Profile_IM_AllowType",Q="Tag_Profile_IM_Language",X="Tag_Profile_IM_Image",Z="Tag_Profile_IM_MsgSettings",ee="Tag_Profile_IM_AdminForbidType",te="Tag_Profile_IM_Level",se="Tag_Profile_IM_Role",ie={GROUP:"Tag_SNS_IM_Group",REMARK:"Tag_SNS_IM_Remark",ADDSOURCE:"Tag_SNS_IM_AddSource",ADDWORDING:"Tag_SNS_IM_Wording",ADDTIME:"Tag_SNS_IM_AddTime"},ne="Gender_Type_",re={UNKNOWN:ne+"Unknown",FEMALE:ne+"Female",MALE:ne+"Male"},oe={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},ae={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},de=Object.prototype.hasOwnProperty;function ue(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(_e(e)){for(var t in e)if(de.call(e,t))return!1;return!0}return!!(ce(e)||le(e)||pe(e))&&0===e.size}let ce=function(e){return"map"===ye(e)},le=function(e){return"set"===ye(e)},pe=function(e){return"file"===ye(e)},he=function(e){return null!==e&&("number"==typeof e&&!isNaN(+e)||"object"==typeof e&&e.constructor===Number)},me=function(e){return"string"==typeof e},_e=function(e){if("object"!=typeof e||null===e)return!1;e=Object.getPrototypeOf(e);if(null===e)return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return e===t},fe=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===ye(e)},ge=function(e){return void 0===e},we=function(e){return e instanceof Error},ye=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},Ae=(Date.now||(Date.now=function(){return(new Date).getTime()}),function(e){if(0===e.length)return 0;let t=0,s=0,i;for(var r="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)i=e[t++].charCodeAt[t]<=255?1:!1===r?3:2,s+=i;return s}),Ie=function(e,t){for(var s in e)if(e[s]===t)return!0;return!1};function Te(){return!v&&!T}let De=0;function Me(){return Te()?"%c Chat %c":"Chat"}function Le(){(e=new Date).setTime(W());var e;return e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){let t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}let Se={arguments2String(s){let i="";if(1===s.length)i=s[0];else for(let e=0,t=s.length;e<t;e++){if(r=s[e],fe(r)||null!==r&&"object"==typeof r)try{i+=we(s[e])?JSON.stringify(s[e],["message","code"]):JSON.stringify(s[e])}catch(e){i+=e?e.message:"";break}else i+=s[e];i+=" "}var r;return i},_exec(e,t){Te()?o[e](Me(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Le(),t):o[e](`${Me()} ${Le()} `+t)},d:function(){var e;De<=-1&&(e=this.arguments2String(arguments),this._exec("debug",e))},l:function(){var e;De<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},log:function(){var e;De<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},i:function(){var e;De<=1&&(e=this.arguments2String(arguments),this._exec("info",e))},w:function(){var e;De<=2&&(e=this.arguments2String(arguments),this._exec("warn",e))},e:function(){var e;De<=3&&(e=this.arguments2String(arguments),this._exec("error",e))},setLevel:function(e){e<4&&this._exec("log","set level from "+De+" to "+e),De=e},getLevel:function(){return De}};class Fe{constructor(e){ue(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.avatar=e.avatar||"",this.time=e.time||0,this.source=e.source||"",this.wording=e.wording||"",this.type=e.type||"")}}let Ee=function(e){return{code:0,data:e||{}}};class ve extends Error{constructor(e){super();var{code:e,message:t,data:s}=e;this.code=e,t?this.message=t:this._getErrMsg&&(this.message=this._getErrMsg(this.code)),this.data=s||{}}}let Pe=2700,ke=2710,Ue=2711,be=2716,Ce=2805,Ne=2903,Ge=3122,Oe=3123,$e="onFriendListUpdated",Re="onFriendGroupListUpdated",qe="onFriendApplicationListUpdated",xe="error",He=null,Be=function(e){return Promise.resolve(Ee(e))},We=function(e,t=!1){if(e instanceof ve)return t&&null!==He&&He.emit(xe,e),Promise.reject(e);if(e instanceof Error){let e=new ve({code:Ne});return t&&null!==He&&He.emit(xe,e),Promise.reject(e)}return ge(e)||ge(e.code)?Promise.reject(new ve({code:Ne})):(e=new ve(e),t&&null!==He&&He.emit(xe,e),Promise.reject(e))},Ke="friend_get",je="friend_get_specified",Ve="friend_check",Ye="friend_delete",Je="friend_add",ze="friend_update",Qe="friend_response",Xe="pendency_get",Ze="pendency_delete",et="pendency_report",st="group_get",it="group_add",nt="group_delete",rt="group_update",ot={info:4,warning:5,error:6},at={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},dt={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16,tui_key_features:16};class ut{constructor(e){this._n="SSOLogData",this.eventType=dt[e]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=e,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=W()}static bindEventStatModule(e){ut.prototype._eventStatModule=e}static bindNetMonitorModule(e){ut.prototype._netMonitorModule=e}updateTimeStamp(){this.timestamp=W()}start(e){return this._startts=e,this}end(e=!1){if(!this._sentFlag){if(this._netMonitorModule){let e=this._netMonitorModule.getNetworkType();this.setNetworkType(e)}var t=W();0===this.costTime&&(this.costTime=t-this._startts),this.setMoreMessage(`startts:${this._startts} endts:`+t),e?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout(()=>{this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)},0)}}setError(t){if(t instanceof Error){if(!this._sentFlag){let e=!0;if(e=this._netMonitorModule?this._netMonitorModule.isOnline():e)t.code&&this.setCode(t.code),t.message&&this.setMoreMessage(t.message);else{let e=Ce;this.setCode(e)}this.setLevel("error")}}else Se.w(this._n+".setError value not instanceof Error, please check!");return this}setCode(e){return ge(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),he(e)?this.code=e:Se.w(this._n+".setCode value not a number, please check!",e,typeof e)),this}setMessage(e){return ge(e)||this._sentFlag||(he(e)&&(this.message=e.toString()),me(e)&&(this.message=e)),this}setCostTime(e){return this.costTime=e,this}setLevel(e){return ge(e)||this._sentFlag||(this.level=ot[e]),this}setMoreMessage(e){return ue(this.moreMessage)?this.moreMessage=""+e:this.moreMessage+=" "+e,this}setNetworkType(e){return ge(e)?Se.w(this._n+".setNetworkType value is undefined, please check!"):(e=at[e.toLowerCase()],ge(e)||(this.networkType=e)),this}getStartTs(){return this._startts}setUIPlatform(e){return this.uiPlatform=e,this}setExtension(e){return this.extension=e,this}setEventType(e){return this.eventType=e,this}}class ct{constructor(e){this._snsM=e,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSeq=0,this._map=new Map,this._unreadCount=0}updateCacheOnReconnected(){this._startTime=0,this._currentSeq=0,this.getApplicationList()}getLocalApplicationList(){return{friendApplicationList:[...this._map.values()],unreadCount:this._unreadCount}}_onApplicationListUpdated(){this._snsM.emitOEvt(qe,{friendApplicationList:[...this._map.values()],unreadCount:this._unreadCount})}onApplicationRead(){this._unreadCount=0,this._onApplicationListUpdated()}onApplicationAdded(e,t){if(!ue(e)){let s,i=(s=t===this._snsM.getMyUserID()?R:$,!1);e.forEach(e=>{var t=e.userID+"_"+s;s!==$||this._map.has(t)||(this._unreadCount+=1),this._map.set(t,new Fe({...e,type:s})),i=!0}),i&&this._onApplicationListUpdated()}}onApplicationDeleted(e){ue(e)||(this._startTime=0,this._currentSeq=0,this.getApplicationList())}getApplicationList(){let r=this._n+".getApplicationList",n=new ut("getApplicationList");return this._snsM.req({P:Xe,data:{applicationType:O,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSeq}}).then(e=>{var{resultList:e,unreadCount:t,startTime:s,currentSequence:i}=e.data,t=(this._startTime=s,this._currentSeq=i,this._unreadCount=t,`applicationCount:${fe(e)?e.length:0} unreadCount:${t} startTime:${s} currentSequence:`+i);n.setMessage(t).end(),Se.i(r+" ok. "+t),this._map.clear(),fe(e)&&e.forEach(e=>{var{userID:t,type:s}=e,e=new Fe(e);this._map.set(t+"_"+s,e)}),this._onApplicationListUpdated()}).catch(e=>(n.setError(e).end(),Se.w(r+" failed. error:",e),We(e)))}deleteApplication(e){let r=this._n+".deleteApplication",{userID:n,type:t}=e,o=t;if(o&&(o===R||o===$)||(o=$),!this._map.has(n+"_"+o))return We({code:be});let a=new ut("deleteApplication");return a.setMessage(`userID:${n} type:`+o),this._snsM.req({P:Ze,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[n],type:o}}).then(e=>{var e=e.data["resultList"],{to:t,resultCode:s,resultInfo:i}=e[0];return a.setMoreMessage("resultList:"+JSON.stringify(e)).end(),Se.i(r+` ok. userID:${n} type:`+o),0===s?Ee():We({userID:t,code:s,message:i})}).catch(e=>(a.setError(e).end(),Se.w(r+" failed. error:",e),We(e)))}acceptApplication(e){let s=this._n+".acceptApplication",{userID:i,remark:t,tag:r,type:n}=e,o=n,a=(o&&(o===q||o===x)||(o=x),new ut("acceptApplication"));return a.setMessage(`userID:${i} type:`+o),this._snsM.req({P:Qe,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:i,remark:t,tag:r,action:o}]}}).then(e=>{a.end();var e=e.data["resultList"],{resultCode:e,resultInfo:t}=e[0];if(0!==e)return We({code:e,message:t});Se.i(s+` ok. userID:${i} type:`+o)}).catch(e=>(a.setError(e).end(),Se.w(s+" failed. error:",e),We(e)))}refuseApplication(e){let s=this._n+".refuseApplication",i=e["userID"],r=new ut("refuseApplication");return r.setMessage("userID:"+i),this._snsM.req({P:Qe,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:i,action:"Response_Action_Reject"}]}}).then(e=>{r.end();var e=e.data["resultList"],{resultCode:e,resultInfo:t}=e[0];if(0!==e)return We({code:e,message:t});Se.i(s+" ok. userID:"+i)}).catch(e=>(r.setError(e).end(),Se.w(s+" failed. error:",e),We(e)))}setApplicationRead(){let t=this._n+".setApplicationRead",s=new ut("setApplicationRead"),e;return this._snsM.req({P:et,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:(e=W()/1e3,Math.round(Number(e)*Math.pow(10,0))/Math.pow(10,0))}}).then(e=>{s.end(),Se.i(t+" ok"),this._unreadCount=0}).catch(e=>(s.setError(e).end(),Se.w(t+" failed. error:",e),We(e)))}reset(){this._maxLimited=100,this._startTime=0,this._currentSeq=0,this._unreadCount=0,this._map.clear()}}class lt{constructor(e){ue(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.gender=e.gender||"",this.birthday=e.birthday||0,this.location=e.location||"",this.selfSignature=e.selfSignature||"",this.allowType=e.allowType||k,this.language=e.language||0,this.avatar=e.avatar||"",this.messageSettings=e.messageSettings||0,this.adminForbidType=e.adminForbidType||U,this.level=e.level||0,this.role=e.role||0,this.lastUpdatedTime=e.lastUpdatedTime||0,this.profileCustomField=[],ue(e.profileCustomField))||e.profileCustomField.forEach(e=>{this.profileCustomField.push({key:e.key,value:e.value})})}validate(s){let e=!0,t="";if(ue(s))return{valid:!1,tips:"empty options"};if(s.profileCustomField){let t=s.profileCustomField.length;var i=null;for(let e=0;e<t;e++){if(i=s.profileCustomField[e],!me(i.key)||-1===i.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!me(i.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}}for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if("profileCustomField"===r)continue;if(ue(s[r])&&!me(s[r])&&!he(s[r])){t="key:"+r+", invalid value:"+s[r],e=!1;continue}switch(r){case"nick":me(s[r])||(t="nick must be a string",e=!1),500<Ae(s[r])&&(t=`nick name limited: must less than or equal to 500 bytes, current size: ${Ae(s[r])} bytes`,e=!1);break;case"gender":Ie(re,s.gender)||(t="key:gender, invalid value:"+s.gender,e=!1);break;case"birthday":he(s.birthday)||(t="birthday must be a number",e=!1);break;case"location":me(s.location)||(t="location must be a string",e=!1);break;case"selfSignature":me(s.selfSignature)||(t="selfSignature must be a string",e=!1);break;case"allowType":Ie(ae,s.allowType)||(t="key:allowType, invalid value:"+s.allowType,e=!1);break;case"language":he(s.language)||(t="language must be a number",e=!1);break;case"avatar":me(s.avatar)||(t="avatar must be a string",e=!1);break;case"messageSettings":0!==s.messageSettings&&1!==s.messageSettings&&(t="messageSettings must be 0 or 1",e=!1);break;case"adminForbidType":Ie(oe,s.adminForbidType)||(t="key:adminForbidType, invalid value:"+s.adminForbidType,e=!1);break;case"level":he(s.level)||(t="level must be a number",e=!1);break;case"role":he(s.role)||(t="role must be a number",e=!1);break;default:t="unknown key:"+r+"  "+s[r],e=!1}}return{valid:e,tips:t}}}class pt{constructor(e,s){this.userID=e,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var i={},r=[];if(i.userID=e,!ue(s)){var n,o="";for(let e=0,t=s.length;e<t;e++)if(o=s[e].tag,n=s[e].value,-1<o.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:o,value:n});else if(-1<o.indexOf("Tag_Profile_Custom"))r.push({key:o,value:n});else switch(o){case K:i.nick=n;break;case j:i.gender=n;break;case V:i.birthday=n;break;case Y:i.location=n;break;case J:i.selfSignature=n;break;case z:i.allowType=n;break;case Q:i.language=n;break;case X:i.avatar=n;break;case Z:i.messageSettings=n;break;case ee:i.adminForbidType=n;break;case te:i.level=n;break;case se:i.role=n;break;case ie.REMARK:this.remark=n;break;case ie.ADDTIME:this.addTime=n;break;case ie.GROUP:this.groupList=JSON.parse(JSON.stringify(n));break;case ie.ADDSOURCE:this.source=n;break;case ie.ADDWORDING:break;default:Se.l("snsProfileItem unknown tag->",s[e].tag)}}this.profile=new lt({...i,profileCustomField:r})}validate(s){let e=!0,t="";if(ue(s))return{valid:!1,tips:"empty options"};if(s.profileCustomField){let t=s.profileCustomField.length;var i=null;for(let e=0;e<t;e++){if(i=s.profileCustomField[e],!me(i.key)||-1===i.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!me(i.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}}for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if("profileCustomField"===r)continue;if(ue(s[r])&&!me(s[r])&&!he(s[r])){t="key:"+r+", invalid value:"+s[r],e=!1;continue}switch(r){case"nick":me(s[r])||(t="nick must be a string",e=!1),500<Ae(s[r])&&(t=`nick name limited: must less than or equal to 500 bytes, current size: ${Ae(s[r])} bytes`,e=!1);break;case"gender":Ie(re,s.gender)||(t="key:gender, invalid value:"+s.gender,e=!1);break;case"birthday":he(s.birthday)||(t="birthday must be a number",e=!1);break;case"location":me(s.location)||(t="location must be a string",e=!1);break;case"selfSignature":me(s.selfSignature)||(t="selfSignature must be a string",e=!1);break;case"allowType":Ie(ae,s.allowType)||(t="key:allowType, invalid value:"+s.allowType,e=!1);break;case"language":he(s.language)||(t="language must be a number",e=!1);break;case"avatar":me(s.avatar)||(t="avatar must be a string",e=!1);break;case"messageSettings":0!==s.messageSettings&&1!==s.messageSettings&&(t="messageSettings must be 0 or 1",e=!1);break;case"adminForbidType":Ie(oe,s.adminForbidType)||(t="key:adminForbidType, invalid value:"+s.adminForbidType,e=!1);break;case"level":he(s.level)||(t="level must be a number",e=!1);break;case"role":he(s.role)||(t="role must be a number",e=!1);break;default:t="unknown key:"+r+"  "+s[r],e=!1}}return{valid:e,tips:t}}update(s){let i="",r,n=[];this.friendCustomField.forEach(e=>{n.push(e.key)});for(let e=0,t=s.length;e<t;e++)if(i=s[e].tag,r=s[e].value,-1<i.indexOf("Tag_SNS_Custom"))-1<n.indexOf(i)?this.friendCustomField.forEach(e=>{e.key===i&&(e.value=r)}):this.friendCustomField.push({key:i,value:r});else if(-1<i.indexOf("Tag_Profile_Custom")){let t=!1;this.profile.profileCustomField.forEach(e=>{e.key===i&&(e.value=r,t=!0)}),t||this.profile.profileCustomField.push({key:i,value:r})}else switch(i){case K:this.profile.nick=r;break;case j:this.profile.gender=r;break;case V:this.profile.birthday=r;break;case Y:this.profile.location=r;break;case J:this.profile.selfSignature=r;break;case z:this.profile.allowType=r;break;case Q:this.profile.language=r;break;case X:this.profile.avatar=r;break;case Z:this.profile.messageSettings=r;break;case ee:this.profile.adminForbidType=r;break;case te:this.profile.level=r;break;case se:this.profile.role=r;break;case ie.REMARK:this.remark=r;break;case ie.ADDTIME:this.addTime=r;break;case ie.GROUP:this.groupList=JSON.parse(JSON.stringify(r));break;case ie.ADDSOURCE:this.source=r;break;case ie.ADDWORDING:break;default:Se.d("snsProfileItem unkown tag->",s[e].tag)}this.timestamp=Date.now(),n.length=0}updateProfile(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}addToGroupList(e){-1===this.groupList.indexOf(e)&&(this.groupList.push(e),this.count=this.groupList.length)}removeFromGroupList(e){e=this.groupList.indexOf(e);-1<e&&(this.groupList.splice(e,1),this.count=this.groupList.length)}}let ht=4,mt=11,_t=12,ft=20,gt=23,wt=27,yt=29;class At{constructor(e){this._snsM=e,this._n="FriendHandler",this._map=new Map,this._startIdx=0,this._standardSeq=0,this._customSeq=0,this._expirationTime=18e4}updateCacheOnReconnected(){this._startIdx=0,this._standardSeq=0,this._customSeq=0,this.pagingGetFriendList()}getLocalFriendList(){return[...this._map.values()]}getFriendRemark(e){return this._map.has(e)?this._map.get(e).remark:""}onFriendProfileModified(e){e=e.dataList;if(!ue(e)){let i=this._snsM.get(mt);e.forEach(e=>{var{userID:t,profileList:s}=e;if(this.isMyFriend(t)){Se.l(this._n+`.onFriendProfileModified. friend account:${t}, profileList:`+JSON.stringify(s));let e=this._map.get(t);e.update(s),i.modifyMessageSentByPeer({conversationID:""+P+t,latestNick:e.profile.nick,latestAvatar:e.profile.avatar})}}),this._onFriendListUpdated()}}onFriendAdded(t){0!==t.length&&(Se.l(this._n+".onFriendAdded userIDList:"+t),t.forEach(e=>{this._map.set(e,new pt(e))}),this.getFriendProfile({userIDList:t}).then(e=>{t.forEach(e=>{var t=this._map.get(e);0<t.groupList.length&&this._snsM.updateWhenFriendAdded({nameList:t.groupList,userID:e})}),this._onFriendListUpdated()}))}onFriendDeleted(e){0!==e.length&&(Se.l(this._n+".onFriendDeleted userIDList:"+e),e.forEach(e=>{var t=this._map.get(e);0<t.groupList.length&&this._snsM.updateWhenFriendDeleted({nameList:t.groupList,userID:e}),this._map.delete(e)}),this._onFriendListUpdated())}_onFriendListUpdated(){this._snsM.emitOEvt($e),this._snsM.get(mt).checkAndPatchRemark()}getFriendProfile(e){let t=this._n+".getFriendProfile",s=e["userIDList"],r=[],n=[],i=[];if(s.forEach(e=>{var t;this._map.has(e)?(t=this._map.get(e),Date.now()-t.timestamp<this._expirationTime?n.push(t):i.push(e)):r.push({userID:e,code:Pe,message:this._snsM.getErrMsg(Pe)})}),0===i.length)return Se.i(t+" newUserIDList is empty"),Be({friendList:n,failureUserIDList:r});let o=new ut("getFriendProfile");return o.setMessage("userIDList:"+i),Se.i(t+" userIDList:"+i),this._snsM.req({P:je,data:{fromAccount:this._snsM.getMyUserID(),userIDList:i}}).then(e=>{o.end(),Se.i(t+" ok");e=e.data.resultList;return e.forEach(t=>{var{to:t,resultCode:e,resultInfo:s,tagValueList:i}=t;if(ge(e)||0===e){let e;this._map.has(t)?(e=this._map.get(t)).update(i):(e=new pt(t,i),this._map.set(t,e)),n.push(e)}else r.push({userID:t,code:e,message:s})}),Ee({friendList:n,failureUserIDList:r})}).catch(e=>(o.setError(e).end(),Se.w(t+" failed. error:",e),We(e)))}isMyFriend(e){return this._map.has(e)}pagingGetFriendList(){let o=this._n+".getFriendList",a=new ut("getFriendList"),d=Date.now();this._snsM.req({P:Ke,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIdx,standardSequence:this._standardSeq,customSequence:this._customSeq}}).then(e=>{var{friendCount:e,resultList:t,nextStartIndex:s,standardSequence:i,customSequence:r,completeFlag:n}=e.data,s=`friendCount:${e} nextStartIndex:${this._startIdx=s} standardSequence:${this._standardSeq=i} customSequence:${this._customSeq=r} completeFlag:${n} cost:`+(e=d,Date.now()-e)+" ms";a.setMessage(s).end(),Se.i(o+" ok.",s),ue(t)||t.forEach(e=>{var{to:e,tagValueList:t}=e;this._map.set(e,new pt(e,t))}),0===n?this.pagingGetFriendList():(this._snsM.emitOEvt($e),this._pagingGetFriendProfile())}).catch(e=>(a.setError(e).end(),Se.w(o+" failed. error:",e),We(e)))}_pagingGetFriendProfile(){var t=[...this._map.keys()],s=this._snsM.get(ht),e=t.length,i=e<=100?1:Math.ceil(e/100);Se.l(this._n+`._pagingGetFriendProfile friendCount:${e} pageCount:`+i);for(let e=0;e<i;e++)s.getUserProfile({userIDList:t.slice(100*e,100*(e+1))}).then(e=>{e.data.forEach(e=>{var t=this._map.get(e.userID);t&&t.updateProfile(e)}),this._onFriendListUpdated()})}addFriend(e){let i=this._n+".addFriend";if(e.wording&&!1===this._snsM.filterProfanity("wording",e))return We({code:Oe});var{to:e,source:t,type:s,wording:r,remark:n,groupName:o}=e;let a=s,d=(a&&(a===b||a===C)||(a=C),new ut("addFriend"));return d.setMessage(`to:${e} source:${t} type:`+a),this._snsM.req({P:Je,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:e,source:t,wording:r,remark:n,groupName:o}],type:a}}).then(e=>{var e=e.data["resultList"],{to:e,resultCode:t,resultInfo:s}=(d.setMoreMessage("resultList:"+JSON.stringify(e)).end(),e[0]);return Se.i(i+` ok. to:${e} type:${a} code:`+t),ge(t)||0===t?Ee({userID:e,code:0}):30539===t?Ee({userID:e,code:t,message:this._snsM.getErrMsg(t)}):We({userID:e,code:t,message:this._snsM.getErrMsg(t)||s})}).catch(e=>(d.setError(e).end(),Se.w(i+" failed. error:",e),We(e)))}deleteFriend(e){let t=this._n+".deleteFriend",{userIDList:s,type:i}=e,r=(1e3<s.length&&(Se.w(t+" "+"the length of userIDList cannot exceed 1000"),s.length=1e3),[]),n=[],o=[];if(s.forEach(e=>{this._map.has(e)?o.push(e):r.push({userID:e,code:Pe,message:this._snsM.getErrMsg(Pe)})}),0===o.length)return Be({successUserIDList:n,failureUserIDList:r});let a=i,d=(a&&(a===N||a===G)||(a=G),new ut("deleteFriend"));return d.setMessage(`userIDList:${o} type:`+a),this._snsM.req({P:Ye,data:{fromAccount:this._snsM.getMyUserID(),userIDList:o,type:a}}).then(e=>{d.end(),Se.i(t+" ok");e=e.data.resultList;return ue(e)||e.forEach(e=>{var{to:e,resultCode:t,resultInfo:s}=e;ge(t)||0===t?n.push({userID:e}):r.push({userID:e,code:t,message:s})}),Ee({successUserIDList:n,failureUserIDList:r})}).catch(e=>(d.setError(e).end(),Se.w(t+" error:",e),We(e)))}updateFriend(e){let{userID:t,remark:i,friendCustomField:n}=e;if(!this._map.has(t))return We({code:Pe});let o=this._n+".updateFriend",a=new ut("updateFriend"),s=(a.setMessage(`userID:${t} remark:${i} friendCustomField:`+n),[]);return ge(i)||s.push({tag:ie.REMARK,value:i}),fe(n)&&0<n.length&&n.forEach(e=>{s.push({tag:e.key,value:e.value})}),this._snsM.req({P:ze,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:t,snsItem:s}]}}).then(e=>{a.end(),Se.i(o+" ok");var e=e.data["resultList"],{to:t,resultCode:e,resultInfo:s}=e[0];if(ge(e)||0===e){let e=this._map.get(t);if(e){ge(i)||(e.remark=i);if(fe(n)&&0<n.length){var r=e.friendCustomField;t=n;if(fe(r)&&fe(t)){let i=!1;t.forEach(({key:t,value:e})=>{var s=r.find(e=>e.key===t);s?s.value!==e&&(s.value=e,i=!0):(r.push({key:t,value:e}),i=!0)})}}this._onFriendListUpdated()}return Ee(e)}return We({code:e,message:s})}).catch(e=>(a.setError(e).end(),Se.w(o+" failed. error:",e),We(e)))}checkFriend(e){let s=this._n+".checkFriend",{userIDList:i,type:t}=e,o=t,a=(o&&(o===B||o===H)||(o=H),new ut("checkFriend"));return a.setMessage(`userIDList:${i} type:`+o),this._snsM.req({P:Ve,data:{fromAccount:this._snsM.getMyUserID(),userIDList:i,type:o}}).then(e=>{a.end(),Se.i(s+` ok. userIDList:${i} type:`+o);let r=[],n=[],t=e.data["resultList"];return fe(t)&&t.forEach(e=>{var{to:e,relation:t,resultCode:s,resultInfo:i}=e;ge(s)||0===s?r.push({userID:e,code:0,relation:t}):n.push({userID:e,code:s,message:i})}),Ee({successUserIDList:r,failureUserIDList:n})}).catch(e=>(a.setError(e).end(),Se.w(s+" failed. error:",e),We(e)))}onAddedToFriendGroup(e){let{name:t,userIDList:s}=e;Se.l(`${this._n}.onAddedToFriendGroup groupName:${t} userIDList:`+s),t&&!ue(s)&&s.forEach(e=>{this._map.has(e)&&this._map.get(e).addToGroupList(t)})}onRemovedFromFriendGroup(e){let{name:t,userIDList:s}=e;Se.l(`${this._n}.onRemovedFromFriendGroup groupName:${t} userIDList:`+s),t&&!ue(s)&&s.forEach(e=>{this._map.has(e)&&this._map.get(e).removeFromGroupList(t)})}reset(){this._map.clear(),this._startIdx=0,this._standardSeq=0,this._customSeq=0}}class It{constructor(e){ue(e)||(this.name=e.name||"",this.userIDList=e.userIDList||[],this.count=this.userIDList.length||0)}addToUserIDList(e){-1===this.userIDList.indexOf(e)&&(this.userIDList.push(e),this.count=this.userIDList.length)}removeFromUserIDList(e){e=this.userIDList.indexOf(e);-1<e&&(this.userIDList.splice(e,1),this.count=this.userIDList.length)}}class Tt{constructor(e){this._snsM=e,this._n="FriendGroupHandler",this._map=new Map}updateCacheOnReconnected(){this.getGroupList()}getLocalGroupList(){return[...this._map.values()]}_onGroupListUpdated(){var e=[...this._map.values()];this._snsM.emitOEvt(Re,e)}getGroupList(){let t=this._n+".getGroupList",s=new ut("getGroupList");return this._snsM.req({P:st,data:{fromAccount:this._snsM.getMyUserID()}}).then(e=>{s.end();e=e.data.resultList;ue(e)?Se.i(t+" ok. count:0"):(Se.i(t+" ok. count:"+e.length),this._map.clear(),e.forEach(e=>{var t=new It(e);this._map.set(e.name,t)}),this._onGroupListUpdated())}).catch(e=>(s.setError(e).end(),Se.w(t+" error:",e),We(e)))}createGroup(e){let s=this._n+".createGroup",{name:i,userIDList:t}=e;if(this._map.has(i))return We({code:ke});let o=`name:${i} userIDList:`+t,a=new ut("createGroup");return a.setMessage(o),this._snsM.req({P:it,data:{fromAccount:this._snsM.getMyUserID(),groupName:[i],userIDList:fe(t)?t:void 0}}).then(e=>{a.end(),Se.l(s+" ok. "+o);let t=e.data["resultList"],r=[],n=[];t&&t.forEach(t=>{let{to:e,resultCode:s,resultInfo:i}=t;if(ge(s)||0===s)r.push(e);else{let e={userID:t.to,code:s,message:i};n.push(e)}});e=new It({name:i,userIDList:r});return this._map.set(i,e),this._snsM.onAddedToFriendGroup({name:i,userIDList:r}),this._onGroupListUpdated(),Ee({friendGroup:e,failureUserIDList:n})}).catch(e=>(a.setError(e).end(),Se.w(s+" failed. error:",e),We(e)))}deleteGroup(e){let s=this._n+".deleteGroup",i=e["name"];if(!this._map.has(i))return this._onGroupNotExist();let r="name:"+i,n=new ut("deleteGroup");return n.setMessage(r),this._snsM.req({P:nt,data:{fromAccount:this._snsM.getMyUserID(),nameList:[i]}}).then(e=>{n.end(),Se.l(s+" ok. "+r);var t=this._map.get(i);return t&&(this._snsM.onRemovedFromFriendGroup({name:i,userIDList:t.userIDList}),this._map.delete(i),t.userIDList.length=0),this._onGroupListUpdated(),Ee(t)}).catch(e=>(n.setError(e).end(),Se.w(s+" failed. error:",e),We(e)))}renameGroup(e){let t=this._n+".renameGroup",{oldName:s,newName:i}=e;if(!this._map.has(s))return this._onGroupNotExist();let r=`oldName:${s} newName:`+i,n=new ut("renameGroup");return n.setMessage(r),this._snsM.req({P:rt,data:{fromAccount:this._snsM.getMyUserID(),oldName:s,newName:i}}).then(()=>{var e;return n.end(),Se.l(t+" ok. "+r),this._map.has(s)?((e=this._map.get(s)).name=i,this._map.delete(s),this._map.set(i,e),this._snsM.onRemovedFromFriendGroup({name:s,userIDList:e.userIDList}),this._snsM.onAddedToFriendGroup({name:i,userIDList:e.userIDList}),this._onGroupListUpdated(),Ee(e)):Ee()}).catch(e=>(n.setError(e).end(),Se.w(t+" failed. error:",e),We(e)))}addToGroup(e){let t=this._n+".addToGroup",{name:s,userIDList:i}=e;if(!this._map.has(s))return this._onGroupNotExist();let r=`name:${s} userIDList:`+i,n=new ut("addToGroup");return n.setMessage(r),this._snsM.req({P:rt,data:{fromAccount:this._snsM.getMyUserID(),oldName:s,updateGroupItem:i.filter(e=>this._snsM.isMyFriend(e)).map(e=>({to:e,updateType:"Update_Type_Add"}))}}).then(e=>(n.end(),Se.l(t+" ok. "+r),this._onGroupUpdated(s,e))).catch(e=>(n.setError(e).end(),Se.w(t+" failed. error:",e),We(e)))}removeFromGroup(e){let t=this._n+".removeFromGroup",{name:s,userIDList:i}=e;if(!this._map.has(s))return this._onGroupNotExist();let r=`name:${s} userIDList:`+i,n=new ut("removeFromGroup");return n.setMessage(r),this._snsM.req({P:rt,data:{fromAccount:this._snsM.getMyUserID(),oldName:s,updateGroupItem:i.filter(e=>this._snsM.isMyFriend(e)).map(e=>({to:e,updateType:"Update_Type_Delete"}))}}).then(e=>(n.end(),Se.l(t+" ok. "+r),this._onGroupUpdated(s,e))).catch(e=>(n.setError(e).end(),Se.w(t+" failed. error:",e),We(e)))}_onGroupUpdated(e,t){let s=t.data["resultList"],n=this._map.get(e),o=[],a=[],d=[],u=!1;return fe(s)&&s.forEach(e=>{var{to:t,resultCode:s,resultInfo:i,type:r}=e;0===s?"Update_Type_Add"===r?n&&(n.addToUserIDList(t),a.push(t),u=!0):"Update_Type_Delete"===r&&n&&(n.removeFromUserIDList(t),d.push(t),u=!0):o.push({to:e.to,code:s,message:i})}),Se.l(this._n+`._onGroupUpdated name:${e} userIDList:`+n.userIDList),0<a.length&&this._snsM.onAddedToFriendGroup({name:e,userIDList:a}),0<d.length&&this._snsM.onRemovedFromFriendGroup({name:e,userIDList:d}),u&&this._onGroupListUpdated(),Ee({friendGroup:n,failureUserIDList:o})}updateWhenFriendAdded(e){let{nameList:s,userID:i}=e;if(Se.l(`${this._n}.updateWhenFriendAdded userID:${i} nameList:`+s),!ue(s)){let t=!1;s.forEach(e=>{this._map.has(e)&&(this._map.get(e).addToUserIDList(i),t=!0)}),t&&this._onGroupListUpdated()}}updateWhenFriendDeleted(e){let{nameList:s,userID:i}=e;if(Se.l(`${this._n}.updateWhenFriendDeleted userID:${i} nameList:`+s),!ue(s)){let t=!1;s.forEach(e=>{this._map.has(e)&&(this._map.get(e).removeFromUserIDList(i),t=!0)}),t&&this._onGroupListUpdated()}}_onGroupNotExist(e){return We({code:Ue})}reset(){this._map.clear()}}class Dt extends class{constructor(e){this._m=e,this._n=""}isLoggedIn(){return this._m.get(_t).isLoggedIn()}isOversea(){return this._m.get(_t).isOversea()}isPrivateNetWork(){var e=this._m.get(_t);return e.isPrivateNetWork()&&!e.getFileDownloadProxy()}getFileDownloadProxy(){return this._m.get(_t).getFileDownloadProxy()}getDownloadFileAuthKey(){return this._m.get(_t).getDownloadFileAuthKey()}getMyUserID(){return this._m.get(_t).getUserID()}getMyTinyID(){return this._m.get(_t).getTinyID()}getSDKAppID(){return this._m.get(_t).getSDKAppID()}isIntl(){return this._m.get(_t).isIntl()}isUsingChatCore(){return this._m.get(_t).isUsingChatCore()}isDevMode(){return this._m.get(_t).isDevMode()}get(e){return this._m.get(e)}getPlatform(){return E}getCloudConfig(e){return this._m.get(gt).getCloudConfig(e)}emitOEvt(e,t){this._m.getOEmitInst().emit(e,t)}emitIEvt(e,t){this._m.getIEmitInst().emit(e,t)}getIEmitInst(){return this._m.getIEmitInst()}req(e){return this._m.get(ft).req(e)}canIUse(e){return this._m.get(wt).canIUse(e)}getErrMsg(e,t,s){return this._m.getErrMsg(e,t,s)}warn(e,t,s){e=this.getErrMsg(e,t,s);e&&Se.w(e)}noUse(e){var t=Ge;return We({code:t,message:this.getErrMsg(t,e)})}}{constructor(t){super(t),this._n="SnsModule",this._friendHandler=new At(this),this._friendApplicationHandler=new ct(this),this._friendGroupHandler=new Tt(this),this.getIEmitInst().on(e.A2KEY_AND_TINYID_UPDATED,this.onContextUpdated,this)}onContextUpdated(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getGroupList(),this._friendApplicationHandler.getApplicationList()}onRelationChainModified(e){e=e.dataList;if(!ue(e)){let t=[],s=[],i=[],r=[],n=!1,o="";e.forEach(e=>{if(3!==e.pushType&&4!==e.pushType||!e.from||(o=e.from),e.friendAddAccount&&(t.push(...e.friendAddAccount),r.push(...e.friendAddAccount)),e.friendDelAccount&&s.push(...e.friendDelAccount),e.friendApplicationAdded&&i.push(...e.friendApplicationAdded),e.friendApplicationDeletedUserIDList&&r.push(...e.friendApplicationDeletedUserIDList),e.reportTime&&7===e.pushType&&(n=!0),e.friendUpInfo){let t={dataList:[]};e.friendUpInfo.forEach(e=>{t.dataList.push({userID:e.friendAccount,profileList:[...e.sns]})}),this.onFriendProfileModified(t)}}),n&&this._friendApplicationHandler.onApplicationRead(),this._friendApplicationHandler.onApplicationAdded(i,o),this._friendApplicationHandler.onApplicationDeleted(r),this._friendHandler.onFriendAdded(t),this._friendHandler.onFriendDeleted(s)}}isMyFriend(e){return this._friendHandler.isMyFriend(e)}filterProfanity(e,t){var s,i=this.get(yt);return!i||({isAllowedToSend:i,modifiedText:s}=i.filterText(t[e],p),!0===i&&(t[e]=s,!0))}onFriendProfileModified(e){this._friendHandler.onFriendProfileModified(e)}getLocalFriendList(e=!0){var t=this._friendHandler.getLocalFriendList();return e?Be(t):t}getFriendRemark(e){return this._friendHandler.getFriendRemark(e)}getFriendList(){return this._friendHandler.pagingGetFriendList()}addFriend(e){return this._friendHandler.addFriend(e)}deleteFriend(e){return this._friendHandler.deleteFriend(e)}checkFriend(e){return this._friendHandler.checkFriend(e)}getFriendProfile(e){return this._friendHandler.getFriendProfile(e)}updateFriend(e){return this._friendHandler.updateFriend(e)}onAddedToFriendGroup(e){this._friendHandler.onAddedToFriendGroup(e)}onRemovedFromFriendGroup(e){this._friendHandler.onRemovedFromFriendGroup(e)}getLocalFriendApplicationList(){var e=this._friendApplicationHandler.getLocalApplicationList();return Be(e)}deleteFriendApplication(e){return this._friendApplicationHandler.deleteApplication(e)}refuseFriendApplication(e){return this._friendApplicationHandler.refuseApplication(e)}acceptFriendApplication(e){return this._friendApplicationHandler.acceptApplication(e)}setFriendApplicationRead(e){return this._friendApplicationHandler.setApplicationRead(e)}getLocalFriendGroupList(){var e=this._friendGroupHandler.getLocalGroupList();return Be(e)}createFriendGroup(e){return this._friendGroupHandler.createGroup(e)}deleteFriendGroup(e){return this._friendGroupHandler.deleteGroup(e)}addToFriendGroup(e){return this._friendGroupHandler.addToGroup(e)}removeFromFriendGroup(e){return this._friendGroupHandler.removeFromGroup(e)}renameFriendGroup(e){return this._friendGroupHandler.renameGroup(e)}updateWhenFriendAdded(e){this._friendGroupHandler.updateWhenFriendAdded(e)}updateWhenFriendDeleted(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}updateCacheOnReconnected(){Se.l(this._n+".updateCacheOnReconnected"),this._friendHandler.updateCacheOnReconnected(),this._friendGroupHandler.updateCacheOnReconnected(),this._friendApplicationHandler.updateCacheOnReconnected()}reset(){Se.l(this._n+".reset"),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}export{Dt as default};